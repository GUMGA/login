!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(7),o=i(r),a=n(8),l=i(a),s=n(6),c=i(s),u=n(3),d=i(u),g=n(5),p=i(g),f=n(9),h=i(f),m=n(4),v=(i(m),n(2)),b=i(v);angular.module("gumga.login",["googleplus",b.default]).component("glLogin",o.default).component("glLoginHeader",c.default).component("glLoginFacebook",d.default).component("glLoginGoogle",p.default).service("GumgaLoginService",l.default).factory("FacebookFactory",h.default.facebookFactory)},function(e,t){!function(e,t){"use strict";function n(){function n(e,t){var n,i={},r=e.split(",");for(n=0;n<r.length;n++)i[t?s(r[n]):r[n]]=!0;return i}function i(t,n){null===t||void 0===t?t="":"string"!=typeof t&&(t=""+t),b.innerHTML=t;var i=5;do{if(0===i)throw g("uinput","Failed to sanitize html because the input is unstable");i--,e.document.documentMode&&m(b),t=b.innerHTML,b.innerHTML=t}while(t!==b.innerHTML);for(var r=b.firstChild;r;){switch(r.nodeType){case 1:n.start(r.nodeName.toLowerCase(),p(r.attributes));break;case 3:n.chars(r.textContent)}var o;if(!(o=r.firstChild)&&(1===r.nodeType&&n.end(r.nodeName.toLowerCase()),o=r.nextSibling,!o))for(;null==o&&(r=r.parentNode,r!==b);)o=r.nextSibling,1===r.nodeType&&n.end(r.nodeName.toLowerCase());r=o}for(;r=b.firstChild;)b.removeChild(r)}function p(e){for(var t={},n=0,i=e.length;n<i;n++){var r=e[n];t[r.name]=r.value}return t}function f(e){return e.replace(/&/g,"&amp;").replace(y,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(k,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(e,t){var n=!1,i=r(e,e.push);return{start:function(e,r){e=s(e),!n&&T[e]&&(n=e),n||I[e]!==!0||(i("<"),i(e),a(r,function(n,r){var o=s(r),a="img"===e&&"src"===o||"background"===o;R[o]!==!0||E[o]===!0&&!t(n,a)||(i(" "),i(r),i('="'),i(f(n)),i('"'))}),i(">"))},end:function(e){e=s(e),n||I[e]!==!0||x[e]===!0||(i("</"),i(e),i(">")),e==n&&(n=!1)},chars:function(e){n||i(f(e))}}}function m(t){for(;t;){if(t.nodeType===e.Node.ELEMENT_NODE)for(var n=t.attributes,i=0,r=n.length;i<r;i++){var o=n[i],a=o.name.toLowerCase();"xmlns:ns1"!==a&&0!==a.lastIndexOf("ns1:",0)||(t.removeAttributeNode(o),i--,r--)}var l=t.firstChild;l&&m(l),t=t.nextSibling}}var v=!1;this.$get=["$$sanitizeUri",function(e){return v&&o(I,L),function(t){var n=[];return u(t,d(n,function(t,n){return!/^unsafe:/.test(e(t,n))})),n.join("")}}],this.enableSvg=function(e){return l(e)?(v=e,this):v},r=t.bind,o=t.extend,a=t.forEach,l=t.isDefined,s=t.lowercase,c=t.noop,u=i,d=h;var b,y=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,k=/([^#-~ |!])/g,x=n("area,br,col,hr,img,wbr"),w=n("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),$=n("rp,rt"),F=o({},$,w),S=o({},w,n("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul")),z=o({},$,n("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),L=n("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan"),T=n("script,style"),I=o({},x,S,z,F),E=n("background,cite,href,longdesc,src,xlink:href"),C=n("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width"),O=n("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0),R=o({},E,O,C);!function(e){var t;if(!e.document||!e.document.implementation)throw g("noinert","Can't create an inert html document");t=e.document.implementation.createHTMLDocument("inert");var n=t.documentElement||t.getDocumentElement(),i=n.getElementsByTagName("body");if(1===i.length)b=i[0];else{var r=t.createElement("html");b=t.createElement("body"),r.appendChild(b),t.appendChild(r)}}(e)}function i(e){var t=[],n=d(t,c);return n.chars(e),t.join("")}var r,o,a,l,s,c,u,d,g=t.$$minErr("$sanitize");t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,r=/^mailto:/i,o=t.$$minErr("linky"),a=t.isDefined,l=t.isFunction,s=t.isObject,c=t.isString;return function(t,u,d){function g(e){e&&y.push(i(e))}function p(e,t){var n,i=v(e);y.push("<a ");for(n in i)y.push(n+'="'+i[n]+'" ');!a(u)||"target"in i||y.push('target="',u,'" '),y.push('href="',e.replace(/"/g,"&quot;"),'">'),g(t),y.push("</a>")}if(null==t||""===t)return t;if(!c(t))throw o("notstring","Expected string but received: {0}",t);for(var f,h,m,v=l(d)?d:s(d)?function(){return d}:function(){return{}},b=t,y=[];f=b.match(n);)h=f[0],f[2]||f[4]||(h=(f[3]?"http://":"mailto:")+h),m=f.index,g(b.substr(0,m)),p(h,f[0].replace(r,"")),b=b.substring(m+f[0].length);return g(b),e(y.join(""))}}])}(window,window.angular)},function(e,t,n){n(1),e.exports="ngSanitize"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={bindings:{appKey:"@",onLogin:"&"},template:'\n\n        <svg version="1.1" data-ng-click="$ctrl.submit()" id="Layer_1" xmlns="http://www.w3.org/2000/svg" style="height: 40px;cursor:pointer;" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        \t viewBox="0 0 291.319 291.319" style="enable-background:new 0 0 291.319 291.319;" xml:space="preserve">\n        <g>\n        \t<path style="fill:#3B5998;" d="M145.659,0c80.45,0,145.66,65.219,145.66,145.66c0,80.45-65.21,145.659-145.66,145.659\n        \t\tS0,226.109,0,145.66C0,65.219,65.21,0,145.659,0z"/>\n        \t<path style="fill:#FFFFFF;" d="M163.394,100.277h18.772v-27.73h-22.067v0.1c-26.738,0.947-32.218,15.977-32.701,31.763h-0.055\n        \t\tv13.847h-18.207v27.156h18.207v72.793h27.439v-72.793h22.477l4.342-27.156h-26.81v-8.366\n        \t\tC154.791,104.556,158.341,100.277,163.394,100.277z"/>\n        </g>\n      </svg>\n\n  ',controller:["FacebookFactory","$transclude",function(e,t){var n=this;e.setLang("pt_BR"),e.init({appId:n.appKey,status:!0,cookie:!1,xfbml:!1,version:"v2.4"}),n.me=function(t){e.api("/me",{fields:"name,email,gender,birthday"},function(e){var i={};i.authResponse=t.authResponse,i.user=e,n.onLogin({data:i})})},n.submit=function(){e.getLoginStatus(function(t){"connected"===t.status?n.me(t):e.login(function(e){"connected"===e.status&&n.me(e)},{scope:"public_profile,email,user_birthday"})})}}]};t.default=n},function(e,t){"use strict";angular.module("googleplus",[]).provider("GooglePlus",[function(){var e={};e.clientId=null,this.setClientId=function(t){return e.clientId=t,this},this.getClientId=function(){return e.clientId},e.apiKey=null,this.setApiKey=function(t){return e.apiKey=t,this},this.getApiKey=function(){return e.apiKey},e.scopes="https://www.googleapis.com/auth/plus.login",this.setScopes=function(t){return e.scopes=t,this},this.getScopes=function(){return e.scopes},this.init=function(t){angular.extend(e,t)},this.enableServerSide=function(){e.accessType="offline",e.responseType="code token id_token gsession"},this.disableServerSide=function(){delete e.accessType,delete e.responseType},this.$get=["$q","$rootScope","$timeout",function(t,n,i){var r,o=function(){};return o.prototype.init=function(t){angular.extend(e,t)},o.prototype.login=function(){r=t.defer();var n={client_id:e.clientId,scope:e.scopes,immediate:!1};return e.accessType&&e.responseType&&(n.access_type=e.accessType,n.response_type=e.responseType),gapi.auth.authorize(n,this.handleAuthResult),r.promise},o.prototype.checkAuth=function(){gapi.auth.authorize({client_id:e.clientId,scope:e.scopes,immediate:!0},this.handleAuthResult)},o.prototype.handleClientLoad=function(){gapi.client.setApiKey(e.apiKey),gapi.auth.init(function(){}),i(this.checkAuth,1)},o.prototype.handleAuthResult=function(e){e&&!e.error?(r.resolve(e),n.$apply()):r.reject("error")},o.prototype.getUser=function(){var e=t.defer();return gapi.client.load("oauth2","v2",function(){gapi.client.oauth2.userinfo.get().execute(function(t){e.resolve(t),n.$apply()})}),e.promise},o.prototype.getToken=function(){return gapi.auth.getToken()},o.prototype.setToken=function(e){return gapi.auth.setToken(e)},o.prototype.logout=function(){gapi.auth.signOut()},new o}]}]).run([function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/client.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}])},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={bindings:{appKey:"@",clientId:"@",scopes:"@?",onLogin:"&"},template:'\n\n        <svg version="1.1" data-ng-click="$ctrl.submit()" id="Layer_1" style="height: 40px;cursor:pointer;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        \t viewBox="0 0 291.32 291.32" style="enable-background:new 0 0 291.32 291.32;" xml:space="preserve">\n        <g>\n        \t<path style="fill:#DD4B39;" d="M145.66,0c80.113,0,145.66,65.547,145.66,145.66s-65.547,145.66-145.66,145.66S0,225.772,0,145.66\n        \t\tS65.547,0,145.66,0z"/>\n        \t<g>\n        \t\t<polygon style="fill:#FFFFFF;" points="219.4,121.079 219.4,137.466 235.786,137.466 235.786,153.853 219.4,153.853 219.4,170.24\n        \t\t\t203.013,170.24 203.013,153.853 186.626,153.853 186.626,137.466 203.013,137.466 203.013,121.079 \t\t"/>\n        \t\t<path style="fill:#FFFFFF;" d="M71.919,186.626c-21.849-21.849-21.849-60.085,0.91-81.933\n        \t\t\tc16.387-16.387,40.056-20.028,60.995-11.835l8.193,4.552l9.104,6.373l-14.566,14.566l-5.462-3.641\n        \t\t\tc-12.745-8.193-30.953-6.373-42.787,5.462c-13.656,13.656-14.566,38.236,0,52.802c13.656,14.566,38.236,14.566,50.981,0\n        \t\t\tc3.641-3.641,7.283-9.104,8.193-14.566v-1.821h-32.773v-18.207h51.891l0.91,4.552v12.745c-0.91,11.835-5.462,23.67-13.656,31.863\n        \t\t\tC132.004,208.475,93.768,208.475,71.919,186.626z"/>\n        \t</g>\n        </g>\n        </svg>\n\n  ',controller:["GooglePlus",function(e){var t=this,n=t.scopes||"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/userinfo.email";e.init({clientId:t.clientId,apiKey:t.appKey,scopes:n}),t.submit=function(){e.login().then(function(n){e.getUser().then(function(e){var i={};i.authResponse=n,i.user=e,t.onLogin({data:i})})},function(e){console.error(e)})}}]};t.default=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={bindings:{register:"@",login:"@",background:"@",logo:"@",menus:"=?",title:"@"},template:'\n    <header class="header-login" style="background-image: url({{$ctrl.background}})">\n      <nav class="login-nav" style="{{$ctrl.menus.length == 0 ? \'border:none;\': \'\'}}">\n        <ul ng-if="$ctrl.menus.length > 0">\n          <li ng-repeat="menu in $ctrl.menus">\n            <a href="{{menu.url}}" ng-if="menu.link" title="menu.label">\n                <div ng-bind-html="menu.icon" style="float: left;margin-right: 5px;"></div>\n                {{menu.label}}\n            </a>\n            <a ui-sref="{{menu.url}}" ng-if="!menu.link" title="menu.label">\n                <div ng-bind-html="menu.icon" style="float: left;margin-right: 5px;"></div>\n                &nbsp;{{menu.label}}\n            </a>\n          </li>\n        </ul>\n      </nav>\n      <div class="logo-box">\n        <img data-ng-src="{{$ctrl.logo}}" title="{{$ctrl.title}}">\n      </div>\n    </header>\n  ',controller:[function(){var e=this;e.menus=e.menus||[]}]};t.default=n},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LoginComponent={bindings:{onLogin:"&",configuration:"=",register:"="},transclude:!0,template:'\n    <section class="login-box">\n\n      <form name="login-form" class="login-form" data-ng-submit="$ctrl.submit(email, password)" novalidate ng-if="$ctrl.step == \'LOGIN\'">\n        <label for="username">\n          <input type="email" name="username" placeholder="E-mail" data-ng-model="email">\n        </label>\n        <label for="password">\n          <input type="password" name="password" placeholder="Senha" data-ng-model="password">\n        </label>\n        <label for="do-login">\n          <button type="submit" name="do-login" class="do-login">{{$ctrl.loginText}}</button>\n        </label>\n\n        <a class="forgot-password" ng-if="$ctrl.forgot && !$ctrl.isUrl($ctrl.forgot)" ui-sref="{{$ctrl.forgot}}">Esqueceu a senha?</a>\n        <a class="forgot-password" ng-if="$ctrl.forgot && $ctrl.isUrl($ctrl.forgot)" href="{{$ctrl.forgot}}">Esqueceu a senha?</a>\n\n        <label for="do-register" style="margin: 10px;" ng-if="$ctrl.registerFields">\n            Não tem uma conta?\n            <a  type="button"\n                style="cursor:pointer;"\n                data-ng-click="$ctrl.updateStep(\'REGISTER\')"\n                name="do-register" class="do-register">Inscreva-se</a>\n        </label>\n        <div style="margin: 25px 35px;" ng-transclude></div>\n      </form>\n\n      <form name="login-form" class="login-form" ng-show="$ctrl.step == \'CHANGE_ORGANIZATION\'">\n\n        <img style="width: 100px;\n        height: 100px;\n        padding: 5px;\n        border: 1px solid #ddd;\n        border-radius: 50%;" data-ng-src="{{$ctrl.user.profileImage}}"/>\n\n        <br>\n        <br>\n        <label>Atualmente em {{$ctrl.organizations.length}} organizações.</label>\n\n        <label for="organization">\n          <input type="text" autocomplete="off" name="username"\n          placeholder="Qual organização deseja entrar?" ng-init="$ctrl.organizationFilter = \'\'" data-ng-model="$ctrl.organizationFilter">\n        </label>\n\n        <div style="background:#f5f5f5;margin-bottom:10px;padding: 10px;cursor: pointer;"\n          data-ng-click="$ctrl.organizationSelected = organization"\n          data-ng-repeat="organization in $ctrl.organizations | filter:{ name: $ctrl.organizationFilter } | limitTo: 5">\n          <span class="text text-muted">{{organization.name}}</span>\n          <span ng-show="$ctrl.organizationSelected.id == organization.id" class="glyphicon glyphicon-ok" aria-hidden="true"></span>\n        </div>\n\n        <label for="do-login">\n          <button type="button"\n                  ng-disabled="!$ctrl.organizationSelected"\n                  data-ng-click="$ctrl.changeOrganization($ctrl.organizationSelected)" name="do-login" class="do-login">{{$ctrl.changeOrganizationText}}</button>\n        </label>\n\n      </form>\n\n      <form name="login-form" class="login-form" ng-show="$ctrl.step == \'REGISTER\'">\n        <label data-ng-repeat="field in $ctrl.registerFields" for="{{field.field}}">\n          <input type="{{field.type}}" name="{{field.field}}" id="{{field.field}}" placeholder="{{field.placeholder}}" data-ng-model="field.value">\n        </label>\n        <label for="do-login">\n          <button type="button"\n          ng-disabled="!$ctrl.registerIsValid()"\n          name="do-login"\n          ng-click="$ctrl.submitRegister()"\n          class="do-login">{{$ctrl.registerText}}</button>\n        </label>\n      </form>\n\n    </section>\n  ',controller:["GumgaLoginService",function(GumgaLoginService){var ctrl=this;if(ctrl.loginText="Entrar",ctrl.changeOrganizationText="Continuar",ctrl.registerText="Inscrever",ctrl.register&&(ctrl.registerFields=ctrl.register.fields),ctrl.organizationFilter="",ctrl.updateStep=function(e){return ctrl.step=e},ctrl.updateStep("LOGIN"),!ctrl.configuration)throw"Please enter the setup object for the gumga login.";ctrl.back=function(e){switch(e){case"LOGIN":ctrl.updateStep(e),delete ctrl.password}},GumgaLoginService.initConfiguration(ctrl.configuration);var createUserImage=function(e){return e.picture?void(e.profileImage="data:"+e.picture.mimeType+";base64,"+e.picture.bytes):void(e.profileImage="src/images/user-without-image.png")};ctrl.submit=function(e,t){ctrl.loginText="Aguarde...",GumgaLoginService.login(e,t).then(function(e){ctrl.user=e.data,createUserImage(ctrl.user),GumgaLoginService.setItemInSession("user",e.data),GumgaLoginService.getOrganizations(e.data.token).then(function(t){GumgaLoginService.setItemInSession("organizations",t.data),1==t.data.length&&ctrl.onLogin({user:e.data,organizations:t.data}),t.data.length>1&&(ctrl.updateStep("CHANGE_ORGANIZATION"),ctrl.organizations=t.data)},function(t){ctrl.onLogin({user:e.data,organizations:void 0})})})},ctrl.changeOrganization=function(e){ctrl.changeOrganizationText="Aguarde...",GumgaLoginService.changeOrganization(ctrl.user.token,e).then(function(e){ctrl.user.organization=e.data.name,ctrl.user.organizationHierarchyCode=e.data.hierarchyCode,ctrl.user.softwareHouse=e.data.isSoftwareHouse,ctrl.user.securityManager=e.data.securityManager,GumgaLoginService.setItemInSession("user",ctrl.user),ctrl.onLogin({user:ctrl.user,organizations:ctrl.organizations}),ctrl.loginText="Entrar",ctrl.updateStep("LOGIN")},function(e){ctrl.changeOrganizationText="Erro :("})},ctrl.isUrl=function(e){return/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)};var getRegisterFieldByName=function(e){return ctrl.registerFields.filter(function(t){return t.field==e})[0]},handlingErrorRegister=function(e,t,n){var i=document.getElementById(t.field),r=document.getElementById(e.field);i&&r&&(i.classList[n?"remove":"add"]("gumga-login-input-error"),r.classList[n?"remove":"add"]("gumga-login-input-error"))};ctrl.registerIsValid=function(){var valid=!0;if(ctrl.registerFields)return ctrl.registerFields.forEach(function(field){field.conditions&&field.conditions.forEach(function(condition){if(condition.operation&&condition.field){var comparatorField=getRegisterFieldByName(condition.field);valid&&(valid=eval("'"+field.value+"' "+condition.operation+" '"+comparatorField.value+"'"),handlingErrorRegister(field,comparatorField,valid))}})}),valid},ctrl.submitRegister=function(){if(ctrl.registerText="Aguarde...",ctrl.registerFields){var e={};ctrl.registerFields.forEach(function(t){e[t.field]=t.value}),ctrl.register.submit(e),ctrl.loginText="Entrar",ctrl.updateStep("LOGIN")}}}]};exports.default=LoginComponent},function(e,t){"use strict";function n(e,t){var n={};return n.login=function(t,i){return e.get(n.configuration.appURL.concat("/public/token/create/".concat(t).concat("/").concat(i)))},n.getOrganizations=function(t){return e.get(n.configuration.appURL.concat("/public/token/organizations/".concat(t)))},n.changeOrganization=function(t,i){return e.get(n.configuration.appURL.concat("/public/token/changeorganization/".concat(t).concat("/").concat(i.id)))},n.setItemInSession=function(e,n){return t.sessionStorage.setItem(e,JSON.stringify(n))},n.initConfiguration=function(e){return n.configuration=e},n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.$inject=["$http","$window"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,i,r){var o=this;n(this,e),this.options={appId:null,status:!0,cookie:!1,xfbml:!1,version:"v2.4",scope:""};var a=["appId","status","cookie","xfbml","version","scope"];a.map(function(e){o[e]=angular.bind(o,o.getSetOption,e)}),this.FB=null,this.FBPromise=null,this.initPromise=null,this.$window=t,this.$timeout=i,this.$q=r,this.lang="en_US",this.loading=!1,this.loaded=!1,this.initialized=!1}return i(e,[{key:"getSetOption",value:function(e,t){return void 0===t?this.options[e]:(this.options[e]=t,this)}},{key:"setLang",value:function(e){this.lang=e}},{key:"handleResponse",value:function(e){!e||e.error?this.reject(e&&e.error||!1):this.resolve(e)}},{key:"addCallbackToPromise",value:function(e,t){var n=e.promise;return"function"==typeof t&&n.then(t),n}},{key:"load",value:function(){var e=this;if(!this.FBPromise){var t=this.$q.defer();this.$window.fbAsyncInit=function(){e.FB=e.$window.FB,e.loading=!1,e.loaded=!0,e.$timeout(function(){return t.resolve(FB)})},function(t,n,i){var r=void 0,o=t.getElementsByTagName(n)[0];t.getElementById(i)||(r=t.createElement(n),r.id=i,r.src="//connect.facebook.net/"+e.lang+"/sdk.js",o.parentNode.insertBefore(r,o))}(this.$window.document,"script","facebook-jssdk"),this.loading=!0,this.FBPromise=t.promise}return this.FBPromise}},{key:"init",value:function(e){var t=this;return this.initPromise||(this.initPromise=this.load().then(function(n){if(e=angular.extend({appId:t.options.appId,status:t.options.status,cookie:t.options.cookie,xfbml:t.options.xfbml,version:t.options.version},e),!e.appId)throw new Error("FacebookService: appId is not set");return n.init(e),t.initialized=!0,n})),this.initPromise}},{key:"getLoginStatus",value:function(e){var t=this;return this.init().then(function(n){var i=t.$q.defer();return n.getLoginStatus(angular.bind(i,t.handleResponse)),t.addCallbackToPromise(i,e)})}},{key:"api",value:function(){var e=this,t=arguments;return this.init().then(function(n){var i=e.$q.defer(),r=Array.prototype.slice.call(t),o=void 0;return"function"==typeof r[r.length-1]&&(o=r.pop()),r.push(angular.bind(i,e.handleResponse)),n.api.apply(n,r),e.addCallbackToPromise(i,o)})}},{key:"login",value:function(e,t){var n=this;return this.init().then(function(i){var r=n.$q.defer();"function"!=typeof e&&(e=null,t=e);var o=function(e){var i=t&&t[e];return void 0===i?n.options[e]:i};return i.login(angular.bind(r,n.handleResponse),{scope:o("scope")}),n.addCallbackToPromise(r,e)})}},{key:"logout",value:function(e){var t=this;return this.getLoginStatus().then(function(n){var i=t.$q.defer();return n.authResponse?t.FB.logout(angular.bind(i,e)):i.reject(n),t.addCallbackToPromise(i,e)})}},{key:"disconnect",value:function(e){var t=this;return this.init().then(function(n){var i=t.$q.defer();return n.api("/me/permissions","DELETE",angular.bind(i,t.handleResponse)),t.addCallbackToPromise(i,e)})}}],[{key:"facebookFactory",value:function(t,n,i){return new e(t,n,i)}}]),e}();t.default=r,r.facebookFactory.$inject=["$window","$timeout","$q"]}]);